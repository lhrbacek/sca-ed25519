#include "main.h"

#include "stm32wrapper.h"

#include "crypto/include/bigint.h"
#include "crypto/include/ed25519.h"

int main(void) {
  clock_setup();
  gpio_setup();
  usart_setup(115200);
  rng_enable();

  send_USART_str((unsigned char *)"Program startet.");

  char str[100];

  unsigned char signed_msg[64] = { 0 };
  unsigned long long signed_msg_len;
  unsigned char msg[] = {
    0xab, 0x11, 0xcc, 0xdd, 0xee, 0xff, 0xee, 0xff, 0xee, 0xdd
  };
  unsigned long long msg_len = sizeof(msg);

  unsigned char priv_pub_key[64] = { // pubkey created with SHAKE256
    0x9d, 0x61, 0xb1, 0x9d, 0xef, 0xfd, 0x5a, 0x60, 0xba, 0x84,
    0x4a, 0xf4, 0x92, 0xec, 0x2c, 0xc4, 0x44, 0x49, 0xc5, 0x69,
    0x7b, 0x32, 0x69, 0x19, 0x70, 0x3b, 0xac, 0x3, 0x1c, 0xae,
    0x7f, 0x60, 0xc, 0xdb, 0x1e, 0xd8, 0x64, 0x17, 0x7, 0x7e,
    0xae, 0xb7, 0x30, 0x37, 0x9c, 0xa3, 0x28, 0x6c, 0x57, 0x9,
    0xaa, 0xfe, 0xc4, 0x6, 0x86, 0xc7, 0x31, 0xa1, 0x2d, 0x63,
    0x49, 0x9e, 0xe0, 0xb5
  };
  
  if (0 == sign(signed_msg, &signed_msg_len, msg, msg_len, priv_pub_key))
  {
    to_string_512bitvalue(str, (UN_512bitValue*)signed_msg);
    send_USART_str((unsigned char *)"my ed25519:");
    send_USART_str((unsigned char *)str);
  } else {
    send_USART_str((unsigned char *)"my ed25519: -1");
  }

  while (1)
    ;

  return 0;
}
